(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-68c0cd74"],{1276:function(e,t,i){"use strict";var a=i("d784"),n=i("44e7"),r=i("825a"),l=i("1d80"),o=i("4840"),s=i("8aa5"),c=i("50c4"),u=i("14c3"),d=i("9263"),h=i("d039"),f=[].push,p=Math.min,g=4294967295,m=!h((function(){return!RegExp(g,"y")}));a("split",2,(function(e,t,i){var a;return a="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(e,i){var a=String(l(this)),r=void 0===i?g:i>>>0;if(0===r)return[];if(void 0===e)return[a];if(!n(e))return t.call(a,e,r);var o,s,c,u=[],h=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),p=0,m=new RegExp(e.source,h+"g");while(o=d.call(m,a)){if(s=m.lastIndex,s>p&&(u.push(a.slice(p,o.index)),o.length>1&&o.index<a.length&&f.apply(u,o.slice(1)),c=o[0].length,p=s,u.length>=r))break;m.lastIndex===o.index&&m.lastIndex++}return p===a.length?!c&&m.test("")||u.push(""):u.push(a.slice(p)),u.length>r?u.slice(0,r):u}:"0".split(void 0,0).length?function(e,i){return void 0===e&&0===i?[]:t.call(this,e,i)}:t,[function(t,i){var n=l(this),r=void 0==t?void 0:t[e];return void 0!==r?r.call(t,n,i):a.call(String(n),t,i)},function(e,n){var l=i(a,e,this,n,a!==t);if(l.done)return l.value;var d=r(e),h=String(this),f=o(d,RegExp),b=d.unicode,y=(d.ignoreCase?"i":"")+(d.multiline?"m":"")+(d.unicode?"u":"")+(m?"y":"g"),v=new f(m?d:"^(?:"+d.source+")",y),S=void 0===n?g:n>>>0;if(0===S)return[];if(0===h.length)return null===u(v,h)?[h]:[];var w=0,x=0,C=[];while(x<h.length){v.lastIndex=m?x:0;var _,D=u(v,m?h:h.slice(x));if(null===D||(_=p(c(v.lastIndex+(m?0:x)),h.length))===w)x=s(h,x,b);else{if(C.push(h.slice(w,x)),C.length===S)return C;for(var L=1;L<=D.length-1;L++)if(C.push(D[L]),C.length===S)return C;x=w=_}}return C.push(h.slice(w)),C}]}),!m)},"13d5":function(e,t,i){"use strict";var a=i("23e7"),n=i("d58f").left,r=i("a640"),l=i("ae40"),o=i("2d00"),s=i("605d"),c=r("reduce"),u=l("reduce",{1:0}),d=!s&&o>79&&o<83;a({target:"Array",proto:!0,forced:!c||!u||d},{reduce:function(e){return n(this,e,arguments.length,arguments.length>1?arguments[1]:void 0)}})},3611:function(e,t,i){"use strict";i("3f5f")},"3f5f":function(e,t,i){},"44e7":function(e,t,i){var a=i("861d"),n=i("c6b6"),r=i("b622"),l=r("match");e.exports=function(e){var t;return a(e)&&(void 0!==(t=e[l])?!!t:"RegExp"==n(e))}},"4e89":function(e,t,i){"use strict";i("b459")},5901:function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("el-card",[i("div",{attrs:{slot:"header"},slot:"header"},[i("el-row",{attrs:{type:"flex",justify:"space-between",align:"middle"}},[i("el-col",{attrs:{span:12}},[i("el-row",{attrs:{type:"flex",align:"middle"}},[i("el-col",{attrs:{span:6}},[i("span",[e._v("教工积分管理")])]),i("el-col",{attrs:{span:12}},[i("el-input",{staticClass:"search-input",attrs:{clearable:"",placeholder:"教工编号/姓名(搜索)"},model:{value:e.infoSearch,callback:function(t){e.infoSearch=t},expression:"infoSearch"}})],1)],1)],1),i("el-col",{staticClass:"btn-area",attrs:{span:12}},[i("el-button",{attrs:{type:"primary"}},[e._v("导出数据")]),1===e.user.logo||"1345995188715585537"===e.user.id?i("el-button",{attrs:{type:"primary"},on:{click:function(t){e.dialogAttendanceVisible=!0}}},[e._v("导入考勤信息")]):e._e(),i("el-button",{attrs:{type:"primary"},on:{click:e.showBatchModifyDialog}},[e._v("批量修改")])],1)],1)],1),i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"multipleTable",attrs:{data:e.tchListCompute.slice((this.currentPage-1)*this.pageSize,this.currentPage*this.pageSize),"header-cell-style":e.headerCellStyle,"row-key":e.getRowKey},on:{"selection-change":e.handleSelectionChange,"sort-change":e.handleSortChange}},[i("el-table-column",{attrs:{type:"selection","reserve-selection":""}}),i("el-table-column",{attrs:{label:"教工编号",prop:"no"}}),i("el-table-column",{attrs:{label:"教工姓名",prop:"name"}}),i("el-table-column",{attrs:{label:"专项积分",prop:"mapList"}},e._l(e.classifyList,(function(t,a){return i("el-table-column",{key:a,attrs:{label:t.classify},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.mapList[a].score))]}}],null,!0)})})),1),i("el-table-column",{attrs:{sortable:"",label:"平均专项积分",prop:"scoreSpecialAverage",width:"140px"}}),i("el-table-column",{attrs:{sortable:"",label:"年度积分",prop:"scoreAnnual"}}),i("el-table-column",{attrs:{sortable:"",label:"平均年度积分",prop:"scoreAnnualAverage",width:"140px"}}),i("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-button",{attrs:{type:"text"},on:{click:function(i){return e.showModifyDialog(t.row)}}},[e._v("修改")])]}}])})],1),i("my-pagination",{attrs:{"current-page":e.currentPage,"page-size":e.pageSize,total:e.tchListCompute.length},on:{handleCurrentChange:e.handleCurrentChange,handleSizeChange:e.handleSizeChange}})],1),i("el-dialog",{attrs:{visible:e.dialogModifyVisible,title:e.title},on:{"update:visible":function(t){e.dialogModifyVisible=t},closed:e.closeModifyDialog}},[i("el-form",{staticClass:"modify-form",attrs:{model:e.tchDto,"label-width":"100px","label-position":"right"}},[e.ifBatch?e._e():i("el-form-item",{attrs:{prop:"no",label:"教工编号："}},[e._v(" "+e._s(e.tchDto.no)+" ")]),e.ifBatch?e._e():i("el-form-item",{attrs:{prop:"name",label:"教工姓名："}},[e._v(" "+e._s(e.tchDto.name)+" ")]),i("el-form-item",{attrs:{label:"记分分类："}},[i("el-select",{model:{value:e.classify,callback:function(t){e.classify=t},expression:"classify"}},e._l(e.classifyOption,(function(e,t){return i("el-option",{key:t,attrs:{label:e.label,value:e.value}})})),1)],1),i("el-form-item",{attrs:{label:"记分理由："}},[i("el-select",{attrs:{"value-key":"id"},on:{change:e.handleSelectChange},model:{value:e.ruleDto,callback:function(t){e.ruleDto=t},expression:"ruleDto"}},e._l(e.classifyCompute,(function(e,t){return i("el-option",{key:t,attrs:{label:e.reason,value:e}})})),1)],1),e.ruleDto.addLimit?i("el-form-item",{attrs:{label:"加分额度："}},[e._v(" "+e._s(e.ruleDto.addLimit)+" ")]):e._e(),e.ruleDto.desLimit?i("el-form-item",{attrs:{label:"扣分额度："}},[e._v(" "+e._s(e.ruleDto.desLimit)+" ")]):e._e(),e.ruleDto.illustrate?i("el-form-item",{attrs:{label:"说明："}},[e._v(" "+e._s(e.ruleDto.illustrate)+" ")]):e._e(),e.ruleDto.addLimit?i("el-form-item",{attrs:{label:"加分："}},[i("el-input",{model:{value:e.record.addScore,callback:function(t){e.$set(e.record,"addScore",t)},expression:"record.addScore"}})],1):e._e(),e.ruleDto.desLimit?i("el-form-item",{attrs:{label:"扣分："}},[i("el-input",{attrs:{placeholder:"扣分填正数即可(扣5分输入5)"},model:{value:e.record.desScore,callback:function(t){e.$set(e.record,"desScore",t)},expression:"record.desScore"}})],1):e._e(),i("el-form-item",{attrs:{label:"备注(可空)："}},[i("el-input",{attrs:{type:"textarea",rows:4,maxlength:"255","show-word-limit":""},model:{value:e.record.remark,callback:function(t){e.$set(e.record,"remark",t)},expression:"record.remark"}})],1)],1),i("div",{staticClass:"btn-area"},[i("el-button",{attrs:{type:"primary"},on:{click:e.tchModifyCommit}},[e._v("确认")]),i("el-button",{attrs:{type:"primary"},on:{click:e.closeModifyDialog}},[e._v("取消")])],1)],1),i("el-dialog",{attrs:{visible:e.dialogAttendanceVisible,title:"导入考勤信息"},on:{"update:visible":function(t){e.dialogAttendanceVisible=t}}},[i("el-image",{attrs:{src:e.attendanceFormat}}),i("div",[i("p",{staticClass:"attention"},[e._v("注意(格式错误将导致导入全部失败)")]),i("p",[e._v("表头顺序任意但是不可缺")])]),i("div",{staticClass:"btn-area-flex"},[i("el-button",{attrs:{type:"primary"},on:{click:e.downloadTemplate}},[e._v("模板下载")]),i("el-upload",{attrs:{action:"","before-upload":e.beforeUpload,"http-request":e.uploadAttendanceFile,"show-file-list":!1}},[i("el-button",{attrs:{type:"primary"}},[e._v("文件上传(.xlsx)")])],1)],1)],1)],1)},n=[],r=(i("a4d3"),i("e01a"),i("4de4"),i("d81d"),i("13d5"),i("b0c0"),i("b64b"),i("d3b7"),i("ac1f"),i("1276"),i("ff44")),l=i.n(r),o=i("6d26"),s={name:"ScoreManage",components:{MyPagination:o["a"]},data:function(){return{attendanceFormat:l.a,user:this.$store.state.user,tchList:[],dialogModifyVisible:!1,currentPage:1,pageSize:10,selectionList:[],infoSearch:"",rule:[],classifyOption:[],classify:"",record:{tchId:"",executorId:"",ruleId:"",addScore:0,desScore:0,remark:""},tchDto:{no:"",name:""},ruleDto:{id:"",classify:"",reason:"",addLimit:"",desLimit:"",illustrate:""},ifBatch:!1,title:"积分修改",dialogAttendanceVisible:!1,loading:!0,classifyList:[]}},methods:{headerCellStyle:function(e){if(3===e.columnIndex)return"textAlign: center"},handleCurrentChange:function(e){this.currentPage=e},handleSizeChange:function(e){this.pageSize=e},getRowKey:function(e){return e.id},sortBy:function(e,t){return"ascending"===t?function(t,i){return t[e]-i[e]}:function(t,i){return i[e]-t[e]}},handleSelectionChange:function(e){this.selectionList=e},handleSortChange:function(e){this.tchList.sort(this.sortBy(e.prop,e.order))},showModifyDialog:function(e){this.ifBatch=!1,this.record.tchId=e.id,this.tchDto.no=e.no,this.tchDto.name=e.name,this.dialogModifyVisible=!0,this.title="积分修改"},showBatchModifyDialog:function(){this.ifBatch=!0,this.dialogModifyVisible=!0,this.title="积分批量修改"},closeModifyDialog:function(){this.ifBatch=!1,this.dialogModifyVisible=!1,this.classify="",this.record={tchId:"",executorId:"",ruleId:"",addScore:0,desScore:0,remark:""},this.ruleDto={id:"",classify:"",reason:"",addLimit:"",desLimit:"",illustrate:""}},tchModifyCommit:function(){var e=this;this.record.executorId=this.user.id,this.record.addScore=this.record.addScore||0,this.record.desScore=""===this.record.desScore?0:-this.record.desScore,this.ifBatch?this.selectionList.length>0?this.$api.modifyScoreBatch({record:this.record,tchList:this.selectionList}).then((function(t){e.getAllUser(),e.$showMsg("success",t.description)})):this.$showMsg("error","请选择要批量修改的用户"):this.$api.modifyScore(this.record).then((function(t){e.$showMsg("success",t.description),e.getAllUser()})),this.closeModifyDialog(),this.$refs.multipleTable.clearSelection()},handleSelectChange:function(e){this.record.ruleId=e.id,this.record.addScore=0,this.record.desScore=0,this.record.remark=""},getAllUser:function(){var e=this,t=new FormData;t.append("userId",this.user.id),this.$api.getAllUser(t).then((function(t){e.tchList=t.data?t.data.filter((function(e){return-1===e.logo})):[],e.tchList.map((function(e){e.mapList.sort((function(e,t){return e.classify.localeCompare(t.classify,"zh")}))})),console.log(e.tchList),e.tchList.length>0&&(e.classifyList=e.tchList[0].mapList)})).finally((function(){e.loading=!1}))},getRule:function(){var e=this,t=new FormData;t.append("userId",this.user.id),this.$api.getRule(t).then((function(t){e.rule=t.data?t.data:[],e.classifyOption=Object.keys(e.countClassify(e.rule)).map((function(e){return{label:e,value:e}}))}))},beforeUpload:function(e){var t=e.name.split(".")[1];if("xlsx"!==t&&"xls"!==t)return this.$showMsg("error","文件格式错误"),!1},uploadAttendanceFile:function(e){var t=this,i=new FormData;i.append("file",e.file),i.append("executorId",this.user.id),this.$api.uploadAttendanceFile(i).then((function(e){t.$showMsg("success",e.description),t.getAllUser()}))},countClassify:function(e){return e.reduce((function(e,t){return e[t.classify]=e[t.classify]+1||1,e}),{})},downloadTemplate:function(){window.location.href="http://172.29.5.152/cdfz/excel/download/attendanceFormat.xlsx"}},watch:{},computed:{tchListCompute:function(){var e=this;return this.infoSearch?this.tchList.filter((function(t,i){return t.no===e.infoSearch||t.name===e.infoSearch})):this.tchList},classifyCompute:function(){var e=this;return this.rule.filter((function(t){return t.classify===e.classify}))}},created:function(){this.getAllUser(),this.getRule()},mounted:function(){}},c=s,u=(i("3611"),i("2877")),d=Object(u["a"])(c,a,n,!1,null,"7f44f574",null);t["default"]=d.exports},"6d26":function(e,t,i){"use strict";var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-pagination",{staticClass:"pagination",attrs:{background:"",layout:"total,sizes,prev,pager,next,jumper",total:e.total,"current-page":e.currentPageDiy,"page-size":e.pageSizeDiy,"page-sizes":[5,10,20,50]},on:{"current-change":e.handleCurrentChange,"size-change":e.handleSizeChange}})},n=[],r=(i("a9e3"),{name:"MyPagination",props:{currentPage:{type:Number,default:1},pageSize:{type:Number,default:10},total:{type:Number,default:0}},data:function(){return{currentPageDiy:1,pageSizeDiy:10}},methods:{handleCurrentChange:function(e){this.$emit("handleCurrentChange",e)},handleSizeChange:function(e){this.$emit("handleSizeChange",e)}},watch:{currentPage:function(e,t){this.currentPageDiy=e},pageSize:function(e,t){this.pageSizeDiy=e}}}),l=r,o=(i("4e89"),i("2877")),s=Object(o["a"])(l,a,n,!1,null,"8756b672",null);t["a"]=s.exports},b459:function(e,t,i){},d58f:function(e,t,i){var a=i("1c0b"),n=i("7b0b"),r=i("44ad"),l=i("50c4"),o=function(e){return function(t,i,o,s){a(i);var c=n(t),u=r(c),d=l(c.length),h=e?d-1:0,f=e?-1:1;if(o<2)while(1){if(h in u){s=u[h],h+=f;break}if(h+=f,e?h<0:d<=h)throw TypeError("Reduce of empty array with no initial value")}for(;e?h>=0:d>h;h+=f)h in u&&(s=i(s,u[h],h,c));return s}};e.exports={left:o(!1),right:o(!0)}},ff44:function(e,t,i){e.exports=i.p+"static/img/attendanceFormat.73dca0b7.png"}}]);
//# sourceMappingURL=chunk-68c0cd74.e1fa573f.js.map